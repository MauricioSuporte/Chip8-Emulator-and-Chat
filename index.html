<html>
	<head>
		<title> Cuiaboy</title>
<script src="https://code.jquery.com/jquery-latest.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
	</head>
	
<body>
<canvas width="160" height="144"></canvas>

<div id="cuiaboy"> <p id="p">Cuiaboy</p><p id="pr"></p></div> 
<br>
<br>
<div id="messageBox">
</div>
<div id="holder">
	<form id="messageForm">
    <input type="text" id="userName" placeholder="Digite seu nome"/>
		<input type="text" id="messageInput" placeholder="Digite algo..."/>
		<button type="submit"  id="btn" onclick="hidel()"> Enviar </button>
	</form>
	<div class="chat" id="chat">
</div>



	<script>

	</script>

</body>

<script>
	$(function(){
		var socket = io.connect();  //conecta com socket
		var $messageForm = $("#messageForm"); //referencia para a div message form
		var $messageInput = $("#messageInput"); //referencia para input box com id message
    var $userName = $("#userName"); //referencia para input box com id userName
		var $chat = $("#chat"); //referencia para div chat
		var test = $messageInput.val("");

		$messageForm.submit(function(e){
			e.preventDefault();

      var author = $userName.val();
      var message = $messageInput.val();

      var messageObject = {
        author: author,
        message: message,
      };

      socket.emit('sendMessage', messageObject);
			$messageInput.val("");
		});

    socket.on("newMessage", data => {
        $chat.append('<br>'  +'<div id="circle" style="font-weight: bold;"> <center>' + data.author + '<textarea id="t" readonly>' + data.message + '</textarea>'+' </div>' + '<br>' );
    });




    showlog = false;
  window.setInterval(function() {
  if(showlog == false){
    var chat = document.getElementById("chat");
    chat.scrollTop = chat.scrollHeight;
    }
  }, 4);


    //Tela Emulador
    var UP = 38, DOWN = 40, LEFT = 37, RIGHT = 39;
    var moveEsquerda = false, moveDireita = false, moveCima = false, moveBaixo = false;
    var cnv = document.querySelector("canvas");
    var ctx = cnv.getContext("2d");
    var p1 = {
      x: 10,
      y: 10
    };

    update();

    window.addEventListener("keydown", keydownHandler);
    window.addEventListener("keyup", keyupHandler);

    function keydownHandler(e){
      var key = e.keyCode;
      if(key === LEFT && key !== RIGHT){
        moveEsquerda = true;
      }
      if(key === RIGHT && key !== LEFT){
        moveDireita = true;
      }
      if(key === UP && key !== DOWN){
        moveCima = true;
      }
      if(key === DOWN && key !== UP){
        moveBaixo = true;
      }
    }

    function keyupHandler(e){
      var key = e.keyCode;
      if(key === LEFT && key !== RIGHT){
        moveEsquerda = false;
      }
      if(key === RIGHT && key !== LEFT){
        moveDireita = false;
      }
      if(key === UP && key !== DOWN){
        moveCima = false;
      }
      if(key === DOWN && key !== UP){
        moveBaixo = false;
      }
    }

    function move(){
      if(moveEsquerda){
        p1.x--;
      }
      if(moveDireita){
        p1.x++;
      }
      if(moveCima){
        p1.y--;
      }
      if(moveBaixo){
        p1.y++;
      }
    }

    function render(){
      ctx.clearRect(0, 0, cnv.width, cnv.height);
      ctx.fillRect(p1.x, p1.y, 50, 50);
    }

    function update(){
      requestAnimationFrame(update, cnv);
      move();
      render();
    }
	});
</script>

<style>
	body{
		background-color: black;
	}

	#p{
		margin-top:9px;
	}

	#pr{
		font-size:12px;
		margin-top:-34px;
		margin-left: 82px;
	}

	#cuiaboy{
		background-color:#0000b3;
		font-family: verdana;
		color:white;
		font-size: 30px;
		text-align:center;
		border: 2px solid white;
		border-radius:15px;
		width:190px;
		height:60px;
	}

	#btn{
    margin-left: 94%;
    position: absolute;
    bottom: 8%;
		background-color: #0000b3;
		font-size:15px;
		font-family: Verdana;
		color:white;
		width:5%;
		height:5%;
		text-align: center;
		border-radius:10px;
		outline:none;
		border: 2px solid white;
	}

	#messageInput{
    position: absolute;
    bottom: 1%;
		margin-left: 78%;
		text-align:center;
		border-radius:10px;
		outline:none;
		shadow:none;
		font-size:15px;
		font-family: Verdana;
		color:black;
		width:15%;
		height:50px;
	}

  #userName{
    position: absolute;
    bottom: 10%;
    margin-left: 78%;
    margin-top: 0px;
    text-align:center;
    border-radius:10px;
    outline:none;
    shadow:none;
    font-size:15px;
    font-family: Verdana;
    color:black;
    width:15%;
    height:50px;
  }

	#t {
    position: absolute;
    left: 40;
		text-align:left;
		font-size:15px;
		font-family: Verdana;
		color:black;
		border: 2px solid black;
		margin-top: -10px;
		margin-left: 72px;
		width:200px;
		height:55px;
		background-color:white;
		border-radius:12px;
		resize: none;
		outline: none;
	}

	#chat{
    position: absolute;
    top: 3%;
    margin-left: 73%;
		border: 6px solid white;
		width:25%;
		background-color:#0000b3;
		border-radius: 10px;
		overflow-y:scroll;
		height:77%;
	}

	::-webkit-scrollbar { 
		display: none;
	}


	#circle{
		width:100px;
		height:40px;
    border: 1px solid black;
		border-radius:50px;
    text-align:center;
		margin-left:5px;
		background-color:green;
	}

	canvas{
		border: solid 6px;
		position: absolute;
    bottom: 40%;
		margin-left: 40%;
    border: 2px solid white;
    background-color: #0000b3;
	}

</style>
</html>	
